<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Pessoal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            padding: 20px 30px;
            background: var(--light);
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: white;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .tab-btn:hover {
            background: var(--primary);
            color: white;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--secondary);
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.income {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .card.expense {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .card.balance {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .card.economy {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .form-section {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .transactions-list {
            margin-top: 20px;
        }

        .transaction-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid;
            transition: all 0.3s;
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .transaction-item.income {
            border-color: var(--success);
        }

        .transaction-item.expense {
            border-color: var(--danger);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .transaction-info p {
            font-size: 0.9em;
            color: #6b7280;
        }

        .transaction-value {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 20px;
        }

        .transaction-value.income {
            color: var(--success);
        }

        .transaction-value.expense {
            color: var(--danger);
        }

        .transaction-actions {
            display: flex;
            gap: 10px;
        }

        .month-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .month-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .month-btn:hover,
        .month-btn.active {
            background: var(--primary);
            color: white;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        table tr:hover {
            background: var(--light);
        }

        .export-section {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .category-bar {
            width: 100%;
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .category-bar-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .transaction-actions {
                width: 100%;
                justify-content: flex-end;
            }

            table {
                font-size: 0.9em;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s;
            display: none;
        }

        .notification.success {
            border-left: 5px solid var(--success);
        }

        .notification.error {
            border-left: 5px solid var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>💰 Controle Financeiro Pessoal</h1>
            <p>Organize suas finanças de forma simples e eficiente</p>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">📊 Dashboard</button>
            <button class="tab-btn" onclick="switchTab('transactions')">💳 Transações</button>
            <button class="tab-btn" onclick="switchTab('monthly')">📅 Visão Mensal</button>
            <button class="tab-btn" onclick="switchTab('reports')">📈 Relatórios</button>
            <button class="tab-btn" onclick="switchTab('export')">💾 Exportar/Importar</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="month-selector">
                <select id="dashboardYear" onchange="updateDashboard()">
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
                <select id="dashboardMonth" onchange="updateDashboard()">
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
            </div>

            <div class="cards-grid">
                <div class="card income">
                    <h3>💵 ENTRADAS</h3>
                    <div class="value" id="totalIncome">R$ 0,00</div>
                </div>
                <div class="card expense">
                    <h3>💸 SAÍDAS</h3>
                    <div class="value" id="totalExpense">R$ 0,00</div>
                </div>
                <div class="card balance">
                    <h3>💰 SALDO</h3>
                    <div class="value" id="totalBalance">R$ 0,00</div>
                </div>
                <div class="card economy">
                    <h3>📊 ECONOMIA</h3>
                    <div class="value" id="economyPercent">0%</div>
                </div>
            </div>

            <div class="form-section">
                <h2>➕ Nova Transação</h2>
                <form id="transactionForm" onsubmit="addTransaction(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="type" required>
                                <option value="income">💵 Entrada</option>
                                <option value="expense">💸 Saída</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descrição</label>
                            <input type="text" id="description" required placeholder="Ex: Salário, Aluguel...">
                        </div>
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" id="value" step="0.01" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="category" required>
                                <option value="Salário">💼 Salário</option>
                                <option value="Freelance">💻 Freelance</option>
                                <option value="Investimentos">📈 Investimentos</option>
                                <option value="Alimentação">🍕 Alimentação</option>
                                <option value="Transporte">🚗 Transporte</option>
                                <option value="Saúde">⚕️ Saúde</option>
                                <option value="Educação">📚 Educação</option>
                                <option value="Lazer">🎮 Lazer</option>
                                <option value="Moradia">🏠 Moradia</option>
                                <option value="Contas">📱 Contas</option>
                                <option value="Outros">📦 Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">✅ Adicionar Transação</button>
                </form>
            </div>

            <div class="transactions-list">
                <h2>📋 Últimas Transações</h2>
                <div id="recentTransactions"></div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content">
            <div class="filters">
                <div class="filter-group">
                    <label>Tipo</label>
                    <select id="filterType" onchange="filterTransactions()">
                        <option value="all">Todas</option>
                        <option value="income">Entradas</option>
                        <option value="expense">Saídas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Categoria</label>
                    <select id="filterCategory" onchange="filterTransactions()">
                        <option value="all">Todas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Data Inicial</label>
                    <input type="date" id="filterDateStart" onchange="filterTransactions()">
                </div>
                <div class="filter-group">
                    <label>Data Final</label>
                    <input type="date" id="filterDateEnd" onchange="filterTransactions()">
                </div>
            </div>

            <div id="filteredTransactions"></div>
        </div>

        <!-- Monthly Tab -->
        <div id="monthly" class="tab-content">
            <div class="month-selector">
                <select id="monthlyYear" onchange="updateMonthlyView()">
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
                <select id="monthlyMonth" onchange="updateMonthlyView()">
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
            </div>

            <table id="monthlyTable">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Entrada</th>
                        <th>Saída</th>
                        <th>Diário</th>
                        <th>Saldo</th>
                    </tr>
                </thead>
                <tbody id="monthlyTableBody"></tbody>
            </table>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="month-selector">
                <select id="reportsYear" onchange="updateReports()">
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>

            <div class="stats-grid" id="reportsContent"></div>
        </div>

        <!-- Export Tab -->
        <div id="export" class="tab-content">
            <div class="form-section">
                <h2>💾 Exportar Dados</h2>
                <p style="margin-bottom: 20px;">Baixe seus dados financeiros em diferentes formatos</p>
                <div class="export-section">
                    <button class="btn btn-primary" onclick="exportJSON()">📄 Exportar JSON</button>
                    <button class="btn btn-primary" onclick="exportCSV()">📊 Exportar CSV</button>
                    <button class="btn btn-primary" onclick="exportExcel()">📗 Exportar Excel</button>
                </div>
            </div>

            <div class="form-section">
                <h2>📥 Importar Dados</h2>
                <p style="margin-bottom: 20px;">Importe dados de um backup anterior (formato JSON)</p>
                <input type="file" id="importFile" accept=".json" style="margin-bottom: 15px;">
                <button class="btn btn-success" onclick="importData()">📥 Importar Arquivo</button>
            </div>

            <div class="form-section">
                <h2>🗑️ Gerenciar Dados</h2>
                <p style="margin-bottom: 20px; color: var(--danger);">⚠️ Atenção: Esta ação não pode ser desfeita!</p>
                <button class="btn btn-danger" onclick="clearAllData()">🗑️ Limpar Todos os Dados</button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Initialize
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        
        // Set current date as default
        document.getElementById('date').valueAsDate = new Date();
        
        // Set current month in selectors
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        document.getElementById('dashboardMonth').value = currentMonth;
        document.getElementById('monthlyMonth').value = currentMonth;
        
        // Initialize app
        updateDashboard();
        updateCategories();

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Update content based on tab
            if (tabName === 'transactions') {
                filterTransactions();
            } else if (tabName === 'monthly') {
                updateMonthlyView();
            } else if (tabName === 'reports') {
                updateReports();
            }
        }

        function addTransaction(event) {
            event.preventDefault();
            
            const transaction = {
                id: Date.now(),
                type: document.getElementById('type').value,
                description: document.getElementById('description').value,
                value: parseFloat(document.getElementById('value').value),
                category: document.getElementById('category').value,
                date: document.getElementById('date').value
            };
            
            transactions.push(transaction);
            saveTransactions();
            
            // Reset form
            document.getElementById('transactionForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            
            updateDashboard();
            showNotification('Transação adicionada com sucesso!', 'success');
        }

        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        function updateDashboard() {
            const year = parseInt(document.getElementById('dashboardYear').value);
            const month = parseInt(document.getElementById('dashboardMonth').value);
            
            const monthTransactions = transactions.filter(t => {
                const date = new Date(t.date);
                return date.getFullYear() === year && date.getMonth() === month;
            });
            
            const income = monthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.value, 0);
            
            const expense = monthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.value, 0);
            
            const balance = income - expense;
            const economy = income > 0 ? ((balance / income) * 100).toFixed(1) : 0;
            
            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpense').textContent = formatCurrency(expense);
            document.getElementById('totalBalance').textContent = formatCurrency(balance);
            document.getElementById('economyPercent').textContent = economy + '%';
            
            // Update recent transactions
            displayRecentTransactions();
        }

        function displayRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            const recent = transactions.slice(-10).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma transação registrada ainda</p></div>';
                return;
            }
            
            container.innerHTML = recent.map(t => `
                <div class="transaction-item ${t.type}">
                    <div class="transaction-info">
                        <h4>${t.description}</h4>
                        <p>${t.category} • ${formatDate(t.date)}</p>
                    </div>
                    <div class="transaction-value ${t.type}">
                        ${t.type === 'income' ? '+' : '-'} ${formatCurrency(t.value)}
                    </div>
                    <div class="transaction-actions">
                        <button class="btn btn-warning" onclick="editTransaction(${t.id})">✏️ Editar</button>
                        <button class="btn btn-danger" onclick="deleteTransaction(${t.id})">🗑️</button>
                    </div>
                </div>
            `).join('');
        }

        function filterTransactions() {
            const type = document.getElementById('filterType').value;
            const category = document.getElementById('filterCategory').value;
            const startDate = document.getElementById('filterDateStart').value;
            const endDate = document.getElementById('filterDateEnd').value;
            
            let filtered = transactions;
            
            if (type !== 'all') {
                filtered = filtered.filter(t => t.type === type);
            }
            
            if (category !== 'all') {
                filtered = filtered.filter(t => t.category === category);
            }
            
            if (startDate) {
                filtered = filtered.filter(t => t.date >= startDate);
            }
            
            if (endDate) {
                filtered = filtered.filter(t => t.date <= endDate);
            }
            
            const container = document.getElementById('filteredTransactions');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma transação encontrada com os filtros selecionados</p></div>';
                return;
            }
            
            container.innerHTML = filtered.reverse().map(t => `
                <div class="transaction-item ${t.type}">
                    <div class="transaction-info">
                        <h4>${t.description}</h4>
                        <p>${t.category} • ${formatDate(t.date)}</p>
                    </div>
                    <div class="transaction-value ${t.type}">
                        ${t.type === 'income' ? '+' : '-'} ${formatCurrency(t.value)}
                    </div>
                    <div class="transaction-actions">
                        <button class="btn btn-warning" onclick="editTransaction(${t.id})">✏️ Editar</button>
                        <button class="btn btn-danger" onclick="deleteTransaction(${t.id})">🗑️</button>
                    </div>
                </div>
            `).join('');
        }

        function updateMonthlyView() {
            const year = parseInt(document.getElementById('monthlyYear').value);
            const month = parseInt(document.getElementById('monthlyMonth').value);
            
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const tbody = document.getElementById('monthlyTableBody');
            
            let html = '';
            let runningBalance = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const dayTransactions = transactions.filter(t => t.date === dateStr);
                
                const dayIncome = dayTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.value, 0);
                
                const dayExpense = dayTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.value, 0);
                
                const dayBalance = dayIncome - dayExpense;
                runningBalance += dayBalance;
                
                html += `
                    <tr>
                        <td>${day}</td>
                        <td style="color: var(--success)">${formatCurrency(dayIncome)}</td>
                        <td style="color: var(--danger)">${formatCurrency(dayExpense)}</td>
                        <td style="font-weight: bold">${formatCurrency(dayBalance)}</td>
                        <td style="font-weight: bold; color: ${runningBalance >= 0 ? 'var(--success)' : 'var(--danger)'}">${formatCurrency(runningBalance)}</td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
        }

        function updateReports() {
            const year = parseInt(document.getElementById('reportsYear').value);
            const container = document.getElementById('reportsContent');
            
            const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            let html = '<div class="stat-card"><h3>📊 Resumo Anual ' + year + '</h3>';
            
            let yearIncome = 0;
            let yearExpense = 0;
            
            months.forEach((monthName, index) => {
                const monthTransactions = transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getFullYear() === year && date.getMonth() === index;
                });
                
                const income = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.value, 0);
                
                const expense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.value, 0);
                
                yearIncome += income;
                yearExpense += expense;
                
                const balance = income - expense;
                
                html += `
                    <div class="stat-item">
                        <span><strong>${monthName}</strong></span>
                        <span style="color: ${balance >= 0 ? 'var(--success)' : 'var(--danger)'}">${formatCurrency(balance)}</span>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Category statistics
            const categories = {};
            transactions.forEach(t => {
                if (!categories[t.category]) {
                    categories[t.category] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') {
                    categories[t.category].income += t.value;
                } else {
                    categories[t.category].expense += t.value;
                }
            });
            
            html += '<div class="stat-card"><h3>📁 Por Categoria</h3>';
            
            Object.entries(categories).forEach(([category, values]) => {
                const total = values.income + values.expense;
                const maxValue = Math.max(...Object.values(categories).map(v => v.income + v.expense));
                const percentage = (total / maxValue * 100);
                
                html += `
                    <div class="stat-item">
                        <div style="flex: 1">
                            <div><strong>${category}</strong></div>
                            <div class="category-bar">
                                <div class="category-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <span style="margin-left: 20px">${formatCurrency(total)}</span>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Summary
            html += `
                <div class="stat-card">
                    <h3>💼 Totais do Ano</h3>
                    <div class="stat-item">
                        <span>Total de Entradas</span>
                        <span style="color: var(--success)">${formatCurrency(yearIncome)}</span>
                    </div>
                    <div class="stat-item">
                        <span>Total de Saídas</span>
                        <span style="color: var(--danger)">${formatCurrency(yearExpense)}</span>
                    </div>
                    <div class="stat-item">
                        <span><strong>Performance</strong></span>
                        <span style="color: ${yearIncome - yearExpense >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold">${formatCurrency(yearIncome - yearExpense)}</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function updateCategories() {
            const categories = [...new Set(transactions.map(t => t.category))];
            const select = document.getElementById('filterCategory');
            
            select.innerHTML = '<option value="all">Todas</option>' +
                categories.map(c => `<option value="${c}">${c}</option>`).join('');
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            document.getElementById('type').value = transaction.type;
            document.getElementById('description').value = transaction.description;
            document.getElementById('value').value = transaction.value;
            document.getElementById('category').value = transaction.category;
            document.getElementById('date').value = transaction.date;
            
            deleteTransaction(id, false);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification('Transação carregada para edição', 'success');
        }

        function deleteTransaction(id, showMsg = true) {
            transactions = transactions.filter(t => t.id !== id);
            saveTransactions();
            updateDashboard();
            filterTransactions();
            updateCategories();
            
            if (showMsg) {
                showNotification('Transação removida com sucesso!', 'success');
            }
        }

        function exportJSON() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `financas_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Arquivo JSON exportado com sucesso!', 'success');
        }

        function exportCSV() {
            if (transactions.length === 0) {
                showNotification('Nenhuma transação para exportar', 'error');
                return;
            }
            
            let csv = 'Data,Tipo,Descrição,Categoria,Valor\n';
            
            transactions.forEach(t => {
                csv += `${t.date},${t.type === 'income' ? 'Entrada' : 'Saída'},${t.description},${t.category},${t.value}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `financas_${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            
            showNotification('Arquivo CSV exportado com sucesso!', 'success');
        }

        function exportExcel() {
            if (transactions.length === 0) {
                showNotification('Nenhuma transação para exportar', 'error');
                return;
            }
            
            let html = '<table><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Categoria</th><th>Valor</th></tr></thead><tbody>';
            
            transactions.forEach(t => {
                html += `<tr><td>${t.date}</td><td>${t.type === 'income' ? 'Entrada' : 'Saída'}</td><td>${t.description}</td><td>${t.category}</td><td>${t.value}</td></tr>`;
            });
            
            html += '</tbody></table>';
            
            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `financas_${new Date().toISOString().split('T')[0]}.xls`);
            link.click();
            
            showNotification('Arquivo Excel exportado com sucesso!', 'success');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Selecione um arquivo para importar', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(imported)) {
                        throw new Error('Formato inválido');
                    }
                    
                    transactions = imported;
                    saveTransactions();
                    updateDashboard();
                    updateCategories();
                    
                    showNotification(`${imported.length} transações importadas com sucesso!`, 'success');
                    fileInput.value = '';
                } catch (error) {
                    showNotification('Erro ao importar arquivo. Verifique o formato.', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('⚠️ ATENÇÃO: Todos os dados serão permanentemente apagados. Deseja continuar?')) {
                if (confirm('Tem certeza? Esta ação não pode ser desfeita!')) {
                    transactions = [];
                    saveTransactions();
                    updateDashboard();
                    updateCategories();
                    showNotification('Todos os dados foram removidos', 'success');
                }
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
