<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>TesteHTML Publisher Avan√ßado</title>
  <style>
    body{margin:0;padding:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:30px;}
    .container{background:#fff;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.1);width:100%;max-width:840px;padding:32px;margin-bottom:30px;}
    h1{text-align:center;color:#333;margin-bottom:20px;}
    .token-info{background:#fff3cd;color:#856404;padding:12px;border-radius:8px;border:1px solid #ffeaa7;margin-bottom:20px;}
    label{display:block;margin:16px 0 6px;color:#333;font-weight:bold;}
    input,textarea,select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:15px;font-family:monospace;}
    textarea{min-height:200px;resize:vertical;}
    .btn{display:inline-block;margin-top:16px;width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;transition:transform .2s;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.2);}
    .btn-secondary{background:#28a745;}
    .btn-danger{background:#dc3545;}
    .status{margin-top:20px;padding:14px;border-radius:8px;display:none;}
    .loading{background:#d1ecf1;color:#0c5460;}
    .success{background:#d4edda;color:#155724;}
    .error{background:#f8d7da;color:#721c24;}
    .file-list{margin-top:30px;}
    .file-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #eee;}
    .file-item:last-child{border-bottom:none;}
    .file-link{color:#667eea;text-decoration:none;font-weight:bold;}
    .file-link:hover{text-decoration:underline;}
    .small{font-size:13px;color:#666;margin-top:4px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ TesteHTML Publisher Avan√ßado</h1>
    <div class="token-info">
      <strong>‚ö†Ô∏è Token via jsonbin.io:</strong> bin <code>68df49ae43b1c97be95893d1</code><br>
      Pasta alvo: <b>testeHTML/</b>
    </div>

    <label for="filename">Nome do arquivo (.html):</label>
    <input type="text" id="filename" placeholder="ex: minha-pagina.html">

    <label for="htmlContent">Conte√∫do HTML:</label>
    <textarea id="htmlContent"></textarea>

    <button id="newBtn" class="btn btn-secondary">üÜï Novo</button>
    <button id="saveBtn" class="btn" disabled>üíæ Salvar/Atualizar</button>
    <button id="deleteBtn" class="btn btn-danger" disabled>üóëÔ∏è Apagar</button>
    <div id="status" class="status"></div>

    <div class="file-list">
      <h2>Arquivos Existentes</h2>
      <div id="fileList"></div>
      <p class="small">Tempo de deploy estimado: ~30s</p>
    </div>
  </div>

<script>
const repoOwner='tehewdev',repoName='tehew.space',folder='testeHTML';
const BIN_ID='68df49ae43b1c97be95893d1';
const ACCESS_KEY='$2a$10$f9KK7vSowGnJI5elo/dAPurqjZAJ3bJaWnsinl/caDfgIcNt28kNi';

let token=null,editingFile=null;
const filenameInput=document.getElementById('filename');
const htmlArea=document.getElementById('htmlContent');
const newBtn=document.getElementById('newBtn');
const saveBtn=document.getElementById('saveBtn');
const deleteBtn=document.getElementById('deleteBtn');
const statusDiv=document.getElementById('status');
const fileListDiv=document.getElementById('fileList');

function show(msg,cls){statusDiv.innerHTML=msg;statusDiv.className='status '+cls;statusDiv.style.display='block';}
function hide(){statusDiv.style.display='none';}
function sanitize(n){return n.toLowerCase().replace(/[^a-z0-9-_.]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');}

async function loadToken(){
  show('Carregando token...','loading');
  try{
    const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{
      headers:{'X-Access-Key':ACCESS_KEY,'X-Bin-Meta':'false'}
    });
    const j=await res.json();
    token=j.github_token;
    if(!token) throw 'Token n√£o encontrado.';
    show('Token carregado!','success');
    saveBtn.disabled=false;
    await listFiles();
  }catch(e){
    show('Erro token: '+e,'error');
  }
}

async function listFiles(){
  try{
    const url=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}`;
    const res=await fetch(url,{headers:{'Authorization':'Bearer '+token}});
    if(!res.ok) throw '';
    const items=await res.json();
    fileListDiv.innerHTML='';
    items.filter(f=>f.name.endsWith('.html')).forEach(f=>{
      const div=document.createElement('div');
      div.className='file-item';
      div.innerHTML=`
        <a href="#" class="file-link">${f.name}</a>
        <button class="btn btn-danger" data-file="${f.name}">üóëÔ∏è</button>
      `;
      fileListDiv.appendChild(div);
      div.querySelector('.file-link').onclick=e=>{
        e.preventDefault();
        loadFile(f.name);
      };
      div.querySelector('button').onclick=e=>{
        e.preventDefault();
        deleteFile(f.name);
      };
    });
  }catch{
    fileListDiv.innerHTML='<p class="error">Falha ao listar arquivos.</p>';
  }
}

async function loadFile(name){
  show('Carregando arquivo...','loading');
  const path=`${folder}/${name}`;
  const url=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
  const res=await fetch(url,{headers:{'Authorization':'Bearer '+token}});
  const j=await res.json();
  const html=decodeURIComponent(escape(atob(j.content.replace(/\n/g,''))));
  filenameInput.value=j.name;
  htmlArea.value=html;
  editingFile=j.sha;
  saveBtn.disabled=false;
  deleteBtn.disabled=false;
  hide();
}

async function saveOrUpdate(){
  const name=sanitize(filenameInput.value.trim());
  const html=htmlArea.value;
  if(!name||!html) return show('Preencha nome e HTML!','error');
  show('Salvando...','loading');
  const path=`${folder}/${name}`;
  const url=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
  const data={message:(editingFile?'Atualiza ':'Cria ')+name,content:btoa(unescape(encodeURIComponent(html))),branch:'main'};
  if(editingFile) data.sha=editingFile;
  const res=await fetch(url,{method:'PUT',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify(data)});
  const j=await res.json();
  if(res.ok){
    show('Salvo! Deploy em ~30s.','success');
    editingFile=j.content.sha;
    await listFiles();
  }else show('Erro: '+j.message,'error');
}

async function deleteFile(name){
  if(!confirm('Confirma apagar '+name+'?')) return;
  show('Apagando...','loading');
  const path=`${folder}/${name}`;
  const url=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
  const resHead=await fetch(url,{headers:{'Authorization':'Bearer '+token}});
  const jHead=await resHead.json();
  const data={message:'Apaga '+name,sha:jHead.sha,branch:'main'};
  const res=await fetch(url,{method:'DELETE',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify(data)});
  const j=await res.json();
  if(res.ok){
    show('Apagado!','success');
    filenameInput.value='';
    htmlArea.value='';
    editingFile=null;
    deleteBtn.disabled=true;
    await listFiles();
  }else show('Erro: '+j.message,'error');
}

newBtn.onclick=()=>{
  filenameInput.value='';
  htmlArea.value='';
  editingFile=null;
  deleteBtn.disabled=true;
  show('Pronto para novo arquivo.','success');
};
saveBtn.onclick=saveOrUpdate;

loadExampleBtn.onclick=()=>{
  htmlArea.value=`<!DOCTYPE html>
<html lang="pt-BR">
<head><meta charset="UTF-8"><title>Exemplo Avan√ßado</title></head>
<body><h1>Editor Completo!</h1><p>Teste cria√ß√£o, update e delete.</p></body>
</html>`;
  show('Exemplo carregado!','success');
};

document.getElementById('publishForm').addEventListener('submit',e=>{
  e.preventDefault(); saveOrUpdate();
});

loadToken();
</script>
</body>
</html>
