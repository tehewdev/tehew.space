<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lista de Compras</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header .date {
            font-size: 0.9em;
            opacity: 0.95;
        }

        .content {
            padding: 15px;
            padding-bottom: 80px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .input-group input, .input-group select {
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-group select {
            background: white url('data:image/svg+xml;utf8,<svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6"/></svg>') no-repeat right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 14px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            min-height: 48px;
        }

        button:active {
            transform: scale(0.97);
        }

        .btn-add {
            background: #10b981;
            color: white;
            grid-column: 1 / -1;
            font-size: 1.05em;
        }

        .btn-new {
            background: #667eea;
            color: white;
        }

        .btn-export {
            background: #f59e0b;
            color: white;
        }

        .btn-clear {
            background: #ef4444;
            color: white;
            grid-column: 1 / -1;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card .number {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .stat-card .label {
            font-size: 0.75em;
            opacity: 0.95;
        }

        .lists-container {
            max-height: none;
            overflow-y: visible;
        }

        .category {
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .category-header {
            background: #f3f4f6;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            min-height: 56px;
        }

        .category-header:active {
            background: #e5e7eb;
        }

        .category-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #1f2937;
        }

        .category-count {
            background: #667eea;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .items-list {
            padding: 0;
        }

        .item {
            display: flex;
            align-items: center;
            padding: 16px 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s;
            min-height: 60px;
        }

        .item:active {
            background: #f9fafb;
        }

        .item:last-child {
            border-bottom: none;
        }

        .item.completed {
            opacity: 0.6;
            background: #f0fdf4;
        }

        .item.completed .item-name {
            text-decoration: line-through;
        }

        .checkbox {
            width: 28px;
            height: 28px;
            margin-right: 12px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .item-name {
            flex: 1;
            font-size: 1.05em;
            color: #1f2937;
            word-break: break-word;
            line-height: 1.4;
        }

        .item-actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }

        .btn-icon {
            background: transparent;
            border: none;
            font-size: 1.4em;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-edit {
            color: #3b82f6;
        }

        .btn-edit:active {
            background: #dbeafe;
        }

        .btn-delete {
            color: #ef4444;
        }

        .btn-delete:active {
            background: #fee2e2;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 0.95em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 400px;
            width: 100%;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #1f2937;
            font-size: 1.4em;
        }

        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 90;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-size: 1.8em;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .fab:active {
            transform: scale(0.9);
        }

        .collapse-toggle {
            display: inline-block;
            margin-left: 8px;
            transition: transform 0.3s;
        }

        .category.collapsed .collapse-toggle {
            transform: rotate(-90deg);
        }

        .category.collapsed .items-list {
            display: none;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 600px;
                margin: 0 auto;
                border-radius: 0;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            }

            .content {
                padding: 25px;
            }

            .header {
                border-radius: 0;
            }

            .button-group {
                grid-template-columns: repeat(3, 1fr);
            }

            .btn-add {
                grid-column: 1 / -1;
            }

            .btn-clear {
                grid-column: auto;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 900px;
            }

            .controls {
                flex-direction: row;
            }

            .input-group {
                flex: 1;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        /* Loading animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛒 Lista de Compras</h1>
            <div class="date" id="currentDate"></div>
        </div>

        <div class="content">
            <div class="controls">
                <div class="input-group">
                    <label for="itemName">Nome do Item</label>
                    <input type="text" id="itemName" placeholder="Ex: Abacate" autocomplete="off" />
                </div>
                <div class="input-group">
                    <label for="categorySelect">Categoria</label>
                    <select id="categorySelect">
                        <option value="Frutas e Vegetais">Frutas e Vegetais</option>
                        <option value="Laticínios">Laticínios</option>
                        <option value="Carnes">Carnes</option>
                        <option value="Temperos">Temperos</option>
                        <option value="Massas">Massas</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Limpeza">Limpeza</option>
                        <option value="Higiene">Higiene</option>
                        <option value="Padaria">Padaria</option>
                        <option value="Outros">Outros</option>
                        <option value="custom">+ Nova Categoria</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-add" onclick="addItem()">➕ Adicionar Item</button>
                <button class="btn-new" onclick="newList()">📝 Nova Lista</button>
                <button class="btn-export" onclick="exportList()">📤 Exportar</button>
                <button class="btn-clear" onclick="clearCompleted()">🗑️ Limpar Comprados</button>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="number" id="totalItems">0</div>
                    <div class="label">Total</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="pendingItems">0</div>
                    <div class="label">Pendentes</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="completedItems">0</div>
                    <div class="label">Comprados</div>
                </div>
            </div>

            <div class="lists-container" id="listsContainer"></div>
        </div>
    </div>

    <div class="modal" id="customCategoryModal" onclick="closeModalOnBackdrop(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2>Nova Categoria</h2>
            <div class="input-group">
                <label for="customCategoryName">Nome da Categoria</label>
                <input type="text" id="customCategoryName" placeholder="Ex: Congelados" autocomplete="off" />
            </div>
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn-add" onclick="saveCustomCategory()">Salvar</button>
                <button class="btn-clear" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        let shoppingList = [];
        let customCategories = [];

        // Carregar dados salvos
        function loadData() {
            const saved = localStorage.getItem('shoppingList');
            const savedCategories = localStorage.getItem('customCategories');
            
            if (saved) {
                shoppingList = JSON.parse(saved);
            } else {
                // Lista de exemplo
                shoppingList = [
                    { id: Date.now() + 1, name: 'Abacate', category: 'Frutas e Vegetais', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 2, name: 'Cebola roxa', category: 'Frutas e Vegetais', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 3, name: 'Tomate', category: 'Frutas e Vegetais', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 4, name: 'Limão', category: 'Frutas e Vegetais', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 5, name: 'Sal', category: 'Temperos', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 6, name: 'Macarrão (1 pacote)', category: 'Massas', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 7, name: 'Leite (1 litro)', category: 'Laticínios', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 8, name: 'Queijo', category: 'Laticínios', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 9, name: 'Carne (patinho/coxão mole)', category: 'Carnes', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 10, name: 'Maizena', category: 'Outros', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 11, name: 'Noz moscada', category: 'Temperos', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 12, name: 'Páprica picante', category: 'Temperos', completed: false, date: new Date().toISOString() },
                    { id: Date.now() + 13, name: 'Páprica defumada', category: 'Temperos', completed: false, date: new Date().toISOString() },
                ];
            }

            if (savedCategories) {
                customCategories = JSON.parse(savedCategories);
                updateCategorySelect();
            }
        }

        // Salvar dados
        function saveData() {
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            localStorage.setItem('customCategories', JSON.stringify(customCategories));
        }

        // Atualizar data
        function updateDate() {
            const dateElement = document.getElementById('currentDate');
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateElement.textContent = now.toLocaleDateString('pt-BR', options);
        }

        // Adicionar item
        function addItem() {
            const itemName = document.getElementById('itemName').value.trim();
            const category = document.getElementById('categorySelect').value;

            if (!itemName) {
                alert('Por favor, digite o nome do item!');
                return;
            }

            if (category === 'custom') {
                document.getElementById('customCategoryModal').classList.add('active');
                return;
            }

            const newItem = {
                id: Date.now(),
                name: itemName,
                category: category,
                completed: false,
                date: new Date().toISOString()
            };

            shoppingList.push(newItem);
            document.getElementById('itemName').value = '';
            saveData();
            renderList();
            
            // Scroll suave para o final
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        // Toggle item completado
        function toggleItem(id) {
            const item = shoppingList.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                saveData();
                renderList();
            }
        }

        // Deletar item
        function deleteItem(id) {
            if (confirm('Deseja realmente remover este item?')) {
                shoppingList = shoppingList.filter(i => i.id !== id);
                saveData();
                renderList();
            }
        }

        // Editar item
        function editItem(id) {
            const item = shoppingList.find(i => i.id === id);
            if (item) {
                const newName = prompt('Editar item:', item.name);
                if (newName && newName.trim()) {
                    item.name = newName.trim();
                    saveData();
                    renderList();
                }
            }
        }

        // Nova lista
        function newList() {
            if (confirm('Deseja criar uma nova lista? A atual será apagada.')) {
                shoppingList = [];
                saveData();
                renderList();
            }
        }

        // Limpar itens comprados
        function clearCompleted() {
            const completedCount = shoppingList.filter(i => i.completed).length;
            if (completedCount === 0) {
                alert('Não há itens comprados para remover!');
                return;
            }
            if (confirm(`Deseja remover ${completedCount} ${completedCount === 1 ? 'item comprado' : 'itens comprados'}?`)) {
                shoppingList = shoppingList.filter(i => !i.completed);
                saveData();
                renderList();
            }
        }

        // Exportar lista
        function exportList() {
            let text = '🛒 LISTA DE COMPRAS\n';
            text += `Data: ${new Date().toLocaleDateString('pt-BR')}\n\n`;

            const categories = [...new Set(shoppingList.map(i => i.category))];
            
            categories.forEach(cat => {
                const items = shoppingList.filter(i => i.category === cat);
                text += `\n📁 ${cat.toUpperCase()}\n`;
                items.forEach(item => {
                    const status = item.completed ? '✅' : '⬜';
                    text += `${status} ${item.name}\n`;
                });
            });

            text += `\n\n📊 ESTATÍSTICAS\n`;
            text += `Total: ${shoppingList.length} itens\n`;
            text += `Pendentes: ${shoppingList.filter(i => !i.completed).length}\n`;
            text += `Comprados: ${shoppingList.filter(i => i.completed).length}\n`;

            // Para mobile, usar Share API se disponível
            if (navigator.share) {
                navigator.share({
                    title: 'Lista de Compras',
                    text: text
                }).catch(err => {
                    // Se falhar, usar método tradicional
                    downloadAsFile(text);
                });
            } else {
                downloadAsFile(text);
            }
        }

        function downloadAsFile(text) {
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lista-compras-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Renderizar lista
        function renderList() {
            const container = document.getElementById('listsContainer');
            
            if (shoppingList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <h3>Lista vazia</h3>
                        <p>Adicione itens para começar!</p>
                    </div>
                `;
                updateStats();
                return;
            }

            const categories = [...new Set(shoppingList.map(i => i.category))];
            let html = '';

            categories.forEach(cat => {
                const items = shoppingList.filter(i => i.category === cat);
                const catId = cat.replace(/\s+/g, '-').toLowerCase();
                html += `
                    <div class="category" id="cat-${catId}">
                        <div class="category-header" onclick="toggleCategory('${catId}')">
                            <span class="category-title">📁 ${cat}<span class="collapse-toggle">▼</span></span>
                            <span class="category-count">${items.length}</span>
                        </div>
                        <div class="items-list">
                            ${items.map(item => `
                                <div class="item ${item.completed ? 'completed' : ''}">
                                    <input type="checkbox" class="checkbox" 
                                           ${item.completed ? 'checked' : ''} 
                                           onchange="toggleItem(${item.id})">
                                    <span class="item-name">${item.name}</span>
                                    <div class="item-actions">
                                        <button class="btn-icon btn-edit" onclick="editItem(${item.id})" title="Editar">✏️</button>
                                        <button class="btn-icon btn-delete" onclick="deleteItem(${item.id})" title="Deletar">🗑️</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            updateStats();
        }

        // Toggle categoria
        function toggleCategory(catId) {
            const category = document.getElementById(`cat-${catId}`);
            if (category) {
                category.classList.toggle('collapsed');
            }
        }

        // Atualizar estatísticas
        function updateStats() {
            document.getElementById('totalItems').textContent = shoppingList.length;
            document.getElementById('pendingItems').textContent = shoppingList.filter(i => !i.completed).length;
            document.getElementById('completedItems').textContent = shoppingList.filter(i => i.completed).length;
        }

        // Modal de categoria customizada
        function saveCustomCategory() {
            const categoryName = document.getElementById('customCategoryName').value.trim();
            if (!categoryName) {
                alert('Por favor, digite o nome da categoria!');
                return;
            }

            customCategories.push(categoryName);
            updateCategorySelect();
            closeModal();
            
            document.getElementById('categorySelect').value = categoryName;
            saveData();
        }

        function updateCategorySelect() {
            const select = document.getElementById('categorySelect');
            const currentValue = select.value;
            
            const defaultOptions = `
                <option value="Frutas e Vegetais">Frutas e Vegetais</option>
                <option value="Laticínios">Laticínios</option>
                <option value="Carnes">Carnes</option>
                <option value="Temperos">Temperos</option>
                <option value="Massas">Massas</option>
                <option value="Bebidas">Bebidas</option>
                <option value="Limpeza">Limpeza</option>
                <option value="Higiene">Higiene</option>
                <option value="Padaria">Padaria</option>
                <option value="Outros">Outros</option>
            `;

            const customOptions = customCategories.map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');

            select.innerHTML = defaultOptions + customOptions + '<option value="custom">+ Nova Categoria</option>';
            select.value = currentValue;
        }

        function closeModal() {
            document.getElementById('customCategoryModal').classList.remove('active');
            document.getElementById('customCategoryName').value = '';
        }

        function closeModalOnBackdrop(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        // Enter para adicionar
        document.getElementById('itemName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addItem();
            }
        });

        document.getElementById('customCategoryName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveCustomCategory();
            }
        });

        // Prevenir zoom no iOS ao focar inputs
        document.addEventListener('touchstart', function() {}, {passive: true});

        // Inicializar
        updateDate();
        loadData();
        renderList();

        // Atualizar data a cada minuto
        setInterval(updateDate, 60000);
    </script>
</body>
</html>