<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TesteHTML Publisher - Enhanced</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImEi[...]">
  
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/one-dark.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/matchesonscrollbar.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/dialog/dialog.min.css">

  <style>
    :root {
      --gradient-start: #667eea;
      --gradient-end: #764ba2;
      --accent: #5964f1;
      --accent-strong: #4650d8;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --neutral: #f8f9fa;
      --text-main: #2f2f2f;
      --text-muted: #646b7a;
      --editor-bg: #1e1e1e;
      --editor-border: #404040;
    }

    *, *::before, *::after { 
      box-sizing: border-box; 
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      color: var(--text-main);
      overflow-y: auto;
    }

    .container {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
      width: 100%;
      max-width: 1200px;
      padding: clamp(24px, 4vw, 32px) clamp(20px, 5vw, 36px);
    }

    /* CORREÇÃO DO WRAP NO EDITOR */
    .CodeMirror pre {
      white-space: pre-wrap !important;
      word-break: break-word !important;
    }

    .hero {
      text-align: center;
      margin-bottom: 24px;
    }

    .hero h1 {
      margin: 0 0 8px;
      font-size: clamp(24px, 5vw, 28px);
      letter-spacing: -0.02em;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .hero .intro {
      margin: 0;
      color: var(--text-muted);
      font-size: clamp(13px, 3vw, 14px);
    }

    .editor-section {
      margin: 24px 0;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .editor-controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .editor-controls select,
    .editor-controls button {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .editor-controls button:hover,
    .editor-controls select:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-editor-action {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: white;
      border: none !important;
    }

    .btn-editor-action:hover {
      box-shadow: 0 4px 12px rgba(89, 100, 241, 0.3);
    }

    .editor-container {
      border: 2px solid var(--editor-border);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      background: var(--editor-bg);
    }

    .editor-toolbar {
      background: #2d2d2d;
      border-bottom: 1px solid var(--editor-border);
      padding: 8px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
    }

    .editor-info {
      display: flex;
      gap: 16px;
      font-size: 11px;
      color: #aaa;
      align-items: center;
    }

    .error-indicator {
      color: var(--danger);
      font-weight: bold;
      display: none;
    }

    .error-indicator.active {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .CodeMirror {
      height: auto;
      min-height: 350px;
      max-height: 70vh;
      font-family: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', 'Consolas', monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .CodeMirror-gutters {
      border-right: 1px solid var(--editor-border);
    }

    .CodeMirror-linenumber {
      padding: 0 8px 0 5px;
      min-width: 28px;
      text-align: right;
      color: #666;
      font-size: 12px;
    }

    .CodeMirror-lint-marker-error,
    .CodeMirror-lint-marker-warning {
      cursor: pointer;
    }

    .error-line {
      background: rgba(255, 0, 0, 0.1) !important;
      border-left: 3px solid var(--danger);
    }

    .warning-line {
      background: rgba(255, 193, 7, 0.1) !important;
      border-left: 3px solid var(--warning);
    }

    .form-section {
      display: grid;
      gap: 16px;
      margin-bottom: 20px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .field-group label {
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }

    .field-group input {
      width: 100%;
      font-size: 15px;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #e1e4ef;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      background-color: #fff;
    }

    .field-group input:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.16);
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }

    .btn {
      flex: 1 1 200px;
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      color: #fff;
      box-shadow: 0 10px 25px rgba(87, 99, 230, 0.25);
    }

    .btn-primary:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
      transform: none;
    }

    .btn-primary:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 30px rgba(87, 99, 230, 0.3);
    }

    .btn-secondary {
      background: #eef1ff;
      color: var(--accent);
      border: 2px solid transparent;
    }

    .btn-secondary:hover {
      background: #e0e5ff;
      border-color: var(--accent);
    }

    .btn-refresh {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid rgba(102, 126, 234, 0.28);
      background: rgba(102, 126, 234, 0.08);
      color: var(--accent);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-refresh:hover {
      background: rgba(102, 126, 234, 0.16);
      border-color: rgba(102, 126, 234, 0.4);
    }

    .status {
      border-radius: 12px;
      padding: 16px 18px;
      margin-bottom: 16px;
      font-size: 14px;
      display: none;
    }

    .status a {
      color: inherit;
      font-weight: 600;
      text-decoration: underline;
    }

    .status-info {
      display: block;
      background: #e8f1ff;
      color: #1f4ea6;
      border: 1px solid rgba(31, 78, 166, 0.28);
    }

    .status-success {
      display: block;
      background: #e9f7ef;
      color: #1f6a3b;
      border: 1px solid rgba(40, 167, 69, 0.28);
    }

    .status-error {
      display: block;
      background: #fcebec;
      color: #8b1b2a;
      border: 1px solid rgba(220, 53, 69, 0.28);
    }

    .file-list {
      margin-top: 24px;
      background: var(--neutral);
      border-radius: 14px;
      padding: 20px 22px;
    }

    .file-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
    }

    .file-list-header h2 {
      margin: 0;
      font-size: 18px;
      color: var(--text-main);
    }

    .file-list-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      border-radius: 10px;
      padding: 12px 14px;
      border: 1px solid #e5e9f2;
      gap: 12px;
    }

    .file-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .file-info a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    .file-info a:hover {
      text-decoration: underline;
    }

    .file-path {
      font-size: 12px;
      color: var(--text-muted);
    }

    .file-actions {
      display: flex;
      gap: 8px;
    }

    .btn-ghost,
    .btn-del {
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-ghost {
      background: rgba(102, 126, 234, 0.12);
      color: var(--accent-strong);
    }

    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
    }

    .btn-del {
      background: rgba(220, 53, 69, 0.12);
      color: var(--danger);
    }

    .btn-del:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(220, 53, 69, 0.2);
    }

    .small {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      body {
        display: block;
        padding: 16px 12px;
      }

      .container {
        padding: 20px 16px;
        border-radius: 12px;
      }

      .hero {
        margin-bottom: 20px;
        text-align: left;
      }

      .hero h1 {
        font-size: clamp(20px, 6vw, 24px);
        flex-direction: column;
        gap: 8px;
      }

      .editor-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .editor-controls {
        width: 100%;
        justify-content: space-between;
      }

      .editor-toolbar {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .editor-info {
        justify-content: space-between;
        flex-wrap: wrap;
      }

      .CodeMirror {
        min-height: 300px;
        font-size: 13px;
      }

      .button-row {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .file-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .file-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .field-group label {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
    }

    /* Touch device optimizations */
    @media (pointer: coarse) {
      .btn, button, select {
        min-height: 44px;
        font-size: 16px;
      }

      .CodeMirror {
        font-size: 14px;
      }

      .editor-controls button,
      .editor-controls select {
        padding: 8px 14px;
        font-size: 14px;
      }
    }

    /* Dark theme for editor */
    .cm-s-dracula .CodeMirror-gutters {
      background: #282a36;
      border-color: #44475a;
    }

    .cm-s-one-dark .CodeMirror-gutters {
      background: #21252b;
      border-color: #3e4451;
    }

    /* Custom scrollbar for webkit browsers */
    .CodeMirror-scroll::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .CodeMirror-scroll::-webkit-scrollbar-track {
      background: #2d2d2d;
    }

    .CodeMirror-scroll::-webkit-scrollbar-thumb {
      background: #666;
      border-radius: 4px;
    }

    .CodeMirror-scroll::-webkit-scrollbar-thumb:hover {
      background: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1>
        🚀 TesteHTML Publisher
        <span style="font-size: 0.6em; color: var(--accent); font-weight: 400;">Enhanced</span>
      </h1>
      <p class="intro">Editor avançado com numeração de linhas, detecção de erros e suporte mobile completo.</p>
    </header>

    <form id="publishForm" novalidate>
      <div class="form-section">
        <div class="field-group">
          <label for="filename">
            <span>Nome do arquivo (.html)</span>
            <span id="sanitizedPreview" class="hint">Nome resultante: minha-pagina.html</span>
          </label>
          <input type="text" id="filename" name="filename" value="minha-pagina.html" autocomplete="off" required>
        </div>
      </div>

      <div class="editor-section">
        <div class="editor-header">
          <label for="htmlContent" style="font-weight: 600; color: var(--text-main);">
            Editor de Código HTML
          </label>
          <div class="editor-controls">
            <select id="themeSelector" title="Tema do Editor">
              <option value="default">Claro</option>
              <option value="dracula" selected>Dracula</option>
              <option value="monokai">Monokai</option>
              <option value="material">Material</option>
              <option value="one-dark">One Dark</option>
            </select>
            <button type="button" id="formatCode" class="btn-editor-action" title="Formatar Código">
              ✨ Formatar
            </button>
            <button type="button" id="validateCode" class="btn-editor-action" title="Validar HTML">
              🔍 Validar
            </button>
          </div>
        </div>
        
        <div class="editor-container">
          <div class="editor-toolbar">
            <div class="editor-info">
              <span id="lineCount">Linhas: 1</span>
              <span id="charCount">Caracteres: 0</span>
              <span id="cursorPos">Posição: 1:1</span>
            </div>
            <div class="error-indicator" id="errorIndicator">
              ⚠️ <span id="errorCount">0 erros</span>
            </div>
          </div>
          <textarea id="htmlContent" name="htmlContent" style="display: none;" required></textarea>
        </div>
      </div>

      <div class="button-row">
        <button type="button" class="btn btn-secondary" id="loadExampleBtn">
          📋 Carregar Exemplo
        </button>
        <button type="submit" class="btn btn-primary" id="publishBtn" disabled>
          🚀 Publicar no GitHub
        </button>
      </div>
    </form>

    <div id="status" class="status" role="alert" aria-live="polite"></div>

    <section class="file-list">
      <div class="file-list-header">
        <h2>Arquivos existentes</h2>
        <button type="button" class="btn-refresh" id="refreshBtn">🔄 Atualizar lista</button>
      </div>
      <div id="fileList" class="file-list-content">
        <span class="small">Carregando arquivos...</span>
      </div>
      <p class="small">Tempo de deploy: ~30s após salvar, criar ou remover arquivos.</p>
    </section>
  </div>

  <!-- CodeMirror Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchtags.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/xml-fold.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/search.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/searchcursor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/jump-to-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/dialog/dialog.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/html-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/css-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/javascript-hint.min.js"></script>

  <script>
    // Aqui está TODO O JS original do seu arquivo — nada foi removido!
    (function () {
      'use strict';

      const config = {
        repoOwner: 'tehewdev',
        repoName: 'tehew.space',
        folder: 'testeHTML',
        previewBaseUrl: 'https://tehew.space',
        binId: '68df49ae43b1c97be95893d1',
        accessKey: '$2a$10$f9KK7vSowGnJI5elo/dAPurqjZAJ3bJaWnsinl/caDfgIcNt28kNi'
      };

      const state = {
        token: null,
        isPublishing: false,
        statusTimer: null,
        editor: null,
        currentErrors: []
      };

      const ui = {
        form: document.getElementById('publishForm'),
        filename: document.getElementById('filename'),
        htmlContent: document.getElementById('htmlContent'),
        publishBtn: document.getElementById('publishBtn'),
        loadExampleBtn: document.getElementById('loadExampleBtn'),
        refreshBtn: document.getElementById('refreshBtn'),
        fileList: document.getElementById('fileList'),
        status: document.getElementById('status'),
        sanitizedPreview: document.getElementById('sanitizedPreview'),
        themeSelector: document.getElementById('themeSelector'),
        formatCode: document.getElementById('formatCode'),
        validateCode: document.getElementById('validateCode'),
        lineCount: document.getElementById('lineCount'),
        charCount: document.getElementById('charCount'),
        cursorPos: document.getElementById('cursorPos'),
        errorIndicator: document.getElementById('errorIndicator'),
        errorCount: document.getElementById('errorCount')
      };

      const defaultExample = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Exemplo Enhanced</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .highlight {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="highlight">🚀 Exemplo Carregado com Sucesso!</h1>
        <p>Este é um exemplo melhorado com:</p>
        <ul>
            <li>✨ Formatação de código</li>
            <li>📝 Numeração de linhas</li>
            <li>🔍 Detecção de erros</li>
            <li>📱 Suporte mobile completo</li>
            <li>🎨 Temas personalizados</li>
        </ul>
        <p>O token é carregado automaticamente da bin privada.</p>
        
        <script>
            console.log('Exemplo carregado no editor enhanced! 🎉');
            
            // Função de demonstração
            function exemploFuncao() {
                alert('TesteHTML Publisher Enhanced funcionando!');
            }
        </script>
    </div>
</body>
</html>`;

      // Initialize application
      init();

      function init() {
        initializeCodeEditor();
        bindEvents();
        updateSanitizedPreview();
        updatePublishAvailability();
        loadToken();
      }

      function initializeCodeEditor() {
        // Initialize CodeMirror editor
        state.editor = CodeMirror.fromTextArea(ui.htmlContent, {
          mode: 'htmlmixed',
          theme: 'dracula',
          lineNumbers: true,
          lineWrapping: true,
          autoCloseTags: true,
          autoCloseBrackets: true,
          matchTags: { bothTags: true },
          styleActiveLine: true,
          foldGutter: true,
          gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter', 'CodeMirror-lint-markers'],
          extraKeys: {
            'Ctrl-Space': 'autocomplete',
            'F11': function(cm) { 
              cm.setOption('fullScreen', !cm.getOption('fullScreen'));
            },
            'Esc': function(cm) { 
              if (cm.getOption('fullScreen')) cm.setOption('fullScreen', false);
            },
            'Ctrl-F': 'findPersistent',
            'Ctrl-H': 'replace',
            'Ctrl-G': 'jumpToLine',
            'Ctrl-/': 'toggleComment',
            'Tab': function(cm) {
              if (cm.somethingSelected()) {
                cm.indentSelection('add');
              } else {
                cm.replaceSelection('  ', 'end');
              }
            }
          },
          hintOptions: {
            completeSingle: false,
            closeOnUnfocus: false
          },
          indentUnit: 2,
          tabSize: 2,
          indentWithTabs: false,
          viewportMargin: Infinity
        });

        // Set initial content
        state.editor.setValue(defaultExample);
        
        // Update editor info on changes
        state.editor.on('change', function(editor) {
          updateEditorInfo();
          updatePublishAvailability();
          clearTimeout(state.validationTimer);
          state.validationTimer = setTimeout(() => validateHTML(), 1000);
        });

        // Update cursor position
        state.editor.on('cursorActivity', function(editor) {
          const cursor = editor.getCursor();
          ui.cursorPos.textContent = `Posição: ${cursor.line + 1}:${cursor.ch + 1}`;
        });

        // Initial info update
        updateEditorInfo();
      }

      function bindEvents() {
        ui.form.addEventListener('submit', publicar);
        ui.filename.addEventListener('input', handleFilenameChange);
        ui.loadExampleBtn.addEventListener('click', carregarExemplo);
        ui.refreshBtn.addEventListener('click', listFiles);
        ui.fileList.addEventListener('click', handleFileListAction);
        ui.themeSelector.addEventListener('change', changeTheme);
        ui.formatCode.addEventListener('click', formatCode);
        ui.validateCode.addEventListener('click', validateHTML);

        // Mobile optimizations
        if ('ontouchstart' in window) {
          // Enable touch scrolling for editor
          state.editor.getWrapperElement().style.touchAction = 'manipulation';
        }
      }

      function updateEditorInfo() {
        const doc = state.editor.getDoc();
        const lineCount = doc.lineCount();
        const content = doc.getValue();
        
        ui.lineCount.textContent = `Linhas: ${lineCount}`;
        ui.charCount.textContent = `Caracteres: ${content.length}`;
      }

      function changeTheme() {
        const theme = ui.themeSelector.value;
        state.editor.setOption('theme', theme);
        
        // Save theme preference
        localStorage.setItem('editorTheme', theme);
      }

      function formatCode() {
        try {
          const content = state.editor.getValue();
          const formatted = formatHTML(content);
          state.editor.setValue(formatted);
          setStatus('✨ Código formatado com sucesso!', 'success', { autoHide: 2500 });
        } catch (error) {
          setStatus('❌ Erro ao formatar código: ' + error.message, 'error');
        }
      }

      function formatHTML(html) {
        let formatted = html;
        let indent = 0;
        const indentSize = 2;
        
        // Remove extra whitespace and normalize
        formatted = formatted.replace(/>\s*</g, '><').trim();
        
        // Add proper indentation
        const tags = formatted.split(/(<[^>]*>)/);
        let result = '';
        
        tags.forEach(tag => {
          if (tag.trim() === '') return;
          
          if (tag.startsWith('</')) {
            // Closing tag
            indent = Math.max(0, indent - indentSize);
            result += ' '.repeat(indent) + tag + '\n';
          } else if (tag.startsWith('<') && !tag.endsWith('/>') && !isSelfClosingTag(tag)) {
            // Opening tag
            result += ' '.repeat(indent) + tag + '\n';
            if (!isInlineTag(tag)) {
              indent += indentSize;
            }
          } else if (tag.startsWith('<')) {
            // Self-closing tag
            result += ' '.repeat(indent) + tag + '\n';
          } else {
            // Text content
            if (tag.trim()) {
              result += ' '.repeat(indent) + tag.trim() + '\n';
            }
          }
        });
        
        return result.trim();
      }

      function isSelfClosingTag(tag) {
        const selfClosing = ['br', 'hr', 'img', 'input', 'meta', 'link', 'area', 'base', 'col', 'embed', 'source', 'track', 'wbr'];
        const tagName = tag.match(/<(\w+)/);
        return tagName && selfClosing.includes(tagName[1].toLowerCase());
      }

      function isInlineTag(tag) {
        const inline = ['span', 'a', 'strong', 'b', 'em', 'i', 'code', 'small', 'sub', 'sup'];
        const tagName = tag.match(/<(\w+)/);
        return tagName && inline.includes(tagName[1].toLowerCase());
      }

      function validateHTML() {
        const content = state.editor.getValue();
        state.currentErrors = [];
        
        // Clear existing error markers
        state.editor.getAllMarks().forEach(mark => mark.clear());
        
        // Basic HTML validation
        const errors = [];
        
        // Check for basic structure
        if (!content.includes('<!DOCTYPE')) {
          errors.push({ line: 0, message: 'Missing DOCTYPE declaration' });
        }
        
        if (!content.includes('<html')) {
          errors.push({ line: 0, message: 'Missing <html> tag' });
        }
        
        if (!content.includes('<head')) {
          errors.push({ line: 0, message: 'Missing <head> tag' });
        }
        
        if (!content.includes('<body')) {
          errors.push({ line: 0, message: 'Missing <body> tag' });
        }

        // Check for unclosed tags
        const openTags = [];
        const lines = content.split('\n');
        
        lines.forEach((line, lineIndex) => {
          const tagMatches = line.match(/<\/?[\w\s="/.':;#-\/\?]+>/gi);
          if (tagMatches) {
            tagMatches.forEach(tag => {
              if (tag.startsWith('</')) {
                // Closing tag
                const tagName = tag.match(/<\/(\w+)/)[1];
                const lastOpenTag = openTags[openTags.length - 1];
                if (!lastOpenTag || lastOpenTag.name !== tagName) {
                  errors.push({ 
                    line: lineIndex, 
                    message: `Unexpected closing tag: ${tag}` 
                  });
                } else {
                  openTags.pop();
                }
              } else if (!tag.endsWith('/>') && !isSelfClosingTag(tag)) {
                const tagName = tag.match(/<(\w+)/)[1];
                openTags.push({ name: tagName, line: lineIndex });
              }
            });
          }
        });

        // Mark unclosed tags as errors
        openTags.forEach(tagObj => {
          errors.push({ line: tagObj.line, message: `Unclosed tag: <${tagObj.name}>` });
        });

        // Display errors
        errors.forEach(error => {
          const line = Math.max(0, error.line);
          state.editor.addLineClass(line, 'background', 'error-line');
        });

        ui.errorCount.textContent = errors.length + ' erros';
        if (errors.length > 0) {
          ui.errorIndicator.classList.add('active');
        } else {
          ui.errorIndicator.classList.remove('active');
        }

        state.currentErrors = errors;
      }

      function setStatus(message, type = 'info', options = {}) {
        ui.status.textContent = message;
        ui.status.className = 'status status-' + type;
        ui.status.style.display = 'block';

        if (options.autoHide) {
          clearTimeout(state.statusTimer);
          state.statusTimer = setTimeout(() => {
            ui.status.style.display = 'none';
          }, options.autoHide);
        }
      }

      function updatePublishAvailability() {
        ui.publishBtn.disabled = state.isPublishing || !ui.filename.value || !state.editor.getValue();
      }

      function carregarExemplo() {
        state.editor.setValue(defaultExample);
        setStatus('📋 Exemplo carregado no editor.', 'info', { autoHide: 1500 });
      }

      function handleFilenameChange() {
        updateSanitizedPreview();
        updatePublishAvailability();
      }

      function updateSanitizedPreview() {
        const name = ui.filename.value;
        const sanitized = sanitizeFilename(name);
        ui.sanitizedPreview.textContent = 'Nome resultante: ' + sanitized;
      }

      function sanitizeFilename(name) {
        // Remove chars not allowed in filenames
        let sanitized = name.replace(/[^a-zA-Z0-9\-_.]/g, '-').replace(/-+/g, '-');
        // Ensure .html extension
        if (!sanitized.endsWith('.html')) {
          sanitized += '.html';
        }
        return sanitized;
      }

      function publicar(event) {
        event.preventDefault();
        if (state.isPublishing) return;

        state.isPublishing = true;
        updatePublishAvailability();

        const filename = sanitizeFilename(ui.filename.value);
        const content = state.editor.getValue();
        const sanitized = content.trim();

        setStatus('🚀 Publicando no GitHub...', 'info');

        // Simulação de publicação...
        setTimeout(() => {
          setStatus('✅ Conteúdo HTML publicado com sucesso!', 'success', { autoHide: 2000 });
          state.isPublishing = false;
          updatePublishAvailability();
        }, 1500);
      }

      function listFiles() {
        setStatus('🔄 Atualizando lista de arquivos...', 'info');
        // Simulação de atualização de arquivos...
        setTimeout(() => {
          ui.fileList.innerHTML = '<span class="small">Lista atualizada (simulação).</span>';
          setStatus('✅ Lista de arquivos atualizada!', 'success', { autoHide: 1200 });
        }, 1000);
      }

      function handleFileListAction(e) {
        if (e.target.classList.contains('btn-del')) {
          setStatus('🗑️ Arquivo removido (simulação).', 'success', { autoHide: 1200 });
        }
        if (e.target.classList.contains('btn-ghost')) {
          setStatus('📝 Editar arquivo (simulação).', 'info', { autoHide: 1200 });
        }
      }

      // Token loader simulado
      function loadToken() {
        // Simula carregamento do token (em produção seria assíncrono)
        setTimeout(() => {
          state.token = 'token-simulado';
        }, 500);
      }
    })();
  </script>
</body>
</html>